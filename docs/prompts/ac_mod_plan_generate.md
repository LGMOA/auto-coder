
# AutoCoder 模块设计规划生成指南

本 prompt 用于指导大模型为尚未实现的 AutoCoder 模块生成设计规划文档，**最终交付产物是 `.ac.mod.md` 文件**，该文档将作为后续代码实现的蓝图和指导。

## 任务概述

你需要根据用户的需求描述，为一个全新的 AutoCoder 模块创建完整的设计规划文档（**.ac.mod.md 文件**），该文档应该：
- 明确定义模块的功能和职责
- 设计清晰的API接口和使用方式
- 规划合理的目录结构和文件组织
- 提供详细的架构设计和依赖关系
- 包含完整的实现指导

## 交付产物说明

**核心交付物**: `.ac.mod.md` 文件
- **文件位置**: 放置在模块目录的根目录下
- **文件命名**: 固定为 `.ac.mod.md`
- **文件性质**: 这是一个隐藏文件（以点开头），包含完整的模块设计文档
- **参考示例**: 可参考 `src/autocoder/common/v2/agent/.ac.mod.md` 的结构和内容组织方式

## 工作流程要求

### 1. 创建工作状态追踪文件

在开始设计前，必须创建 `todo-list.md` 文件来记录你的设计过程：

```markdown
# 模块设计规划任务清单

## 基本信息
- **模块名称**: [待确定]
- **模块路径**: [待确定]
- **功能描述**: [用户需求描述]
- **开始时间**: [当前时间]
- **预计完成时间**: [预估时间]

## 设计进度

### 阶段 1: 需求分析和理解 ⏳
- [ ] 分析用户需求描述
- [ ] 明确模块的核心功能
- [ ] 识别模块的使用场景
- [ ] 确定模块的边界和职责
- [ ] 分析与现有模块的关系

### 阶段 2: 架构设计 ⏳
- [ ] 设计模块的整体架构
- [ ] 确定核心类和接口
- [ ] 规划数据模型和类型定义
- [ ] 设计错误处理机制
- [ ] 确定配置和扩展点

### 阶段 3: API设计 ⏳
- [ ] 设计公开API接口
- [ ] 定义函数签名和参数
- [ ] 设计使用示例和最佳实践
- [ ] 规划配置选项和默认值
- [ ] 设计事件和回调机制

### 阶段 4: 文件结构规划 ⏳
- [ ] 设计目录结构
- [ ] 规划文件组织和命名
- [ ] 确定模块依赖关系
- [ ] 设计测试文件结构
- [ ] 规划文档和示例文件

### 阶段 5: 实现指导 ⏳
- [ ] 编写实现步骤指导
- [ ] 设计开发里程碑
- [ ] 确定技术难点和解决方案
- [ ] 规划测试策略
- [ ] 提供性能和安全考虑

### 阶段 6: 文档完善 ⏳
- [ ] 完善设计文档内容
- [ ] 验证设计的一致性
- [ ] 检查API的完整性
- [ ] 优化使用示例
- [ ] 添加实现注意事项

## 当前状态
**进行中的任务**: [当前正在执行的具体任务]
**完成百分比**: 0%
**设计决策**: [记录重要的设计决策和理由]
**技术挑战**: [识别的技术挑战和解决思路]
**下一步计划**: [下一步要执行的任务]

## 设计日志
- [时间] 开始需求分析...
```

### 2. 在每个设计阶段更新状态

在完成每个设计任务时，必须更新 `todo-list.md` 文件：
- 将完成的任务标记为 ✅
- 更新当前状态和完成百分比
- 记录重要的设计决策和理由
- 添加设计日志条目

## 设计文档标准

### .ac.mod.md 文件结构要求

**重要说明**: `.ac.mod.md` 文件是本任务的**最终交付产物**，必须严格按照以下结构创建。可参考现有示例 `src/autocoder/common/v2/agent/.ac.mod.md` 的组织方式。

### 必需章节结构

按照以下结构创建 `.ac.mod.md` 设计文档：

```markdown
# [模块名称]

[一句话描述模块的核心功能和在 AutoCoder 项目中的价值]

## 设计概述

### 功能定位
[详细描述模块的功能定位和使用场景]

### 核心价值
[说明模块解决的问题和带来的价值]

### 设计原则
[列出模块设计遵循的核心原则]

## 目录结构（规划）

```
[模块路径]/
├── __init__.py                    # 模块初始化，导出公开API
├── [核心文件1].py                 # [核心功能描述]
├── [核心文件2].py                 # [核心功能描述]
├── types.py                       # 类型定义和数据模型
├── exceptions.py                  # 自定义异常类
├── config.py                      # 配置管理（如需要）
├── [子模块目录]/                  # [子模块功能描述]
│   ├── __init__.py               # [子模块初始化]
│   ├── [子文件1].py              # [子文件功能描述]
│   └── [子文件2].py              # [子文件功能描述]
├── tests/                         # 测试文件目录
│   ├── __init__.py
│   ├── test_[核心文件1].py       # [对应的测试文件]
│   └── test_[核心文件2].py       # [对应的测试文件]
├── examples/                      # 使用示例目录
│   ├── basic_usage.py            # 基础使用示例
│   └── advanced_usage.py         # 高级使用示例
└── .ac.mod.md                     # 本设计文档
```

## API设计

### 核心接口

```python
# 主要类设计
class [主要类名]:
    """[类的功能描述]"""
    
    def __init__(self, [参数列表]):
        """
        初始化方法
        
        Args:
            [参数]: [参数描述]
        """
        pass
    
    def [核心方法1](self, [参数]) -> [返回类型]:
        """
        [方法功能描述]
        
        Args:
            [参数]: [参数描述]
            
        Returns:
            [返回值描述]
            
        Raises:
            [异常类型]: [异常条件描述]
        """
        pass

# 辅助函数设计
def [辅助函数名]([参数]) -> [返回类型]:
    """
    [函数功能描述]
    
    Args:
        [参数]: [参数描述]
        
    Returns:
        [返回值描述]
    """
    pass
```

### 数据模型设计

```python
# 核心数据模型
@dataclass
class [数据模型名]:
    """[数据模型描述]"""
    
    [字段1]: [类型] = [默认值]  # [字段描述]
    [字段2]: [类型] = [默认值]  # [字段描述]
    
    def validate(self) -> None:
        """验证数据模型的有效性"""
        pass

# 配置模型
@dataclass  
class [配置类名]:
    """[配置描述]"""
    
    [配置项1]: [类型] = [默认值]  # [配置项描述]
    [配置项2]: [类型] = [默认值]  # [配置项描述]
```

### 异常设计

```python
class [模块名]Error(Exception):
    """[模块名]基础异常"""
    pass

class [具体异常名]([模块名]Error):
    """[具体异常描述]"""
    pass
```

## 使用示例（设计）

### 基本使用方式

```python
from [模块路径] import [主要类名], [辅助类名]

# 1. 基础配置
config = [配置类名](
    [配置项1]=[值1],
    [配置项2]=[值2]
)

# 2. 创建实例
instance = [主要类名](config)

# 3. 基本操作
result = instance.[核心方法](参数)
print(f"结果: {result}")

# 4. 高级操作
advanced_result = instance.[高级方法](
    参数1=值1,
    参数2=值2
)
```

### 高级使用场景

```python
# 场景1: [具体场景描述]
[场景1的代码示例]

# 场景2: [具体场景描述]  
[场景2的代码示例]

# 场景3: [具体场景描述]
[场景3的代码示例]
```

### 集成示例

```python
# 与其他AutoCoder模块的集成使用
from autocoder.[其他模块] import [其他类]

# 集成使用示例
[集成代码示例]
```

## 架构设计

### 核心组件

#### 1. [组件1名称]

**职责：**
- [职责1]：[详细描述]
- [职责2]：[详细描述]

**设计要点：**
- [设计要点1]
- [设计要点2]

**接口设计：**
- `[方法1]()`: [方法功能]
- `[方法2]()`: [方法功能]

#### 2. [组件2名称]

**职责：**
- [职责描述]

**设计要点：**
- [设计要点]

### 数据流设计

[描述数据在模块中的流转过程]

### 状态管理

[如果涉及状态管理，描述状态的设计和管理方式]

### 错误处理策略

[描述错误处理的设计策略]

## 依赖关系设计

### Mermaid 依赖图

```mermaid
graph TB
    %% 核心模块
    [主模块][主模块.py<br/>核心功能]
    [子模块1][子模块1.py<br/>功能描述]
    [类型模块][types.py<br/>数据模型]
    
    %% 外部依赖
    [外部模块1][外部模块1<br/>外部依赖]
    [AutoCoder核心][AutoCoder核心模块]
    
    %% 依赖关系
    [主模块] --> [子模块1]
    [主模块] --> [类型模块]
    [主模块] --> [外部模块1]
    [主模块] --> [AutoCoder核心]
    
    %% 样式定义
    classDef coreClass fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef subClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    classDef externalClass fill:#fff3e0,stroke:#f57c00,stroke-width:1px
    
    class [主模块] coreClass
    class [子模块1],[类型模块] subClass
    class [外部模块1],[AutoCoder核心] externalClass
```

### 依赖说明

1. **内部依赖**：
   - [依赖关系描述]

2. **外部依赖**：
   - [外部依赖描述]

3. **可选依赖**：
   - [可选依赖描述]

## 实现指导

### 开发阶段规划

#### 阶段1: 基础框架（第1-2周）
**目标**: [阶段目标]

**任务清单**:
- [ ] 创建项目目录结构
- [ ] 实现基础数据模型
- [ ] 设计核心接口
- [ ] 编写基础测试框架

**验收标准**:
- [验收标准1]
- [验收标准2]

#### 阶段2: 核心功能（第3-4周）
**目标**: [阶段目标]

**任务清单**:
- [ ] 实现核心功能
- [ ] 添加错误处理
- [ ] 编写单元测试
- [ ] 完善API接口

#### 阶段3: 高级功能（第5-6周）
**目标**: [阶段目标]

**任务清单**:
- [ ] 实现高级功能
- [ ] 性能优化
- [ ] 集成测试
- [ ] 文档完善

### 技术实现要点

#### 关键技术难点
1. **[技术难点1]**: [描述和解决方案]
2. **[技术难点2]**: [描述和解决方案]

#### 性能考虑
- [性能考虑点1]
- [性能考虑点2]

#### 安全考虑
- [安全考虑点1]
- [安全考虑点2]

### 测试策略

#### 单元测试
```python
# 测试示例框架
class Test[主要类名]:
    def test_[功能1](self):
        """测试[功能1]"""
        # Given
        [测试准备]
        
        # When
        [执行操作]
        
        # Then
        [验证结果]
```

#### 集成测试
[集成测试的设计思路]

#### 性能测试
[性能测试的设计思路]

## 配置和扩展设计

### 配置选项

[详细列出所有配置选项及其默认值]

### 扩展点设计

[描述模块的扩展机制]

### 插件架构（如适用）

[如果支持插件，描述插件架构设计]

## 与现有系统集成

### AutoCoder集成点

[描述与AutoCoder现有系统的集成方式]

### 事件系统集成

[如果需要，描述与事件系统的集成]

### 配置系统集成

[描述与配置系统的集成]

## 部署和维护

### 安装要求

[列出安装和运行要求]

### 配置部署

[描述部署配置]

### 监控和日志

[描述监控和日志策略]

### 故障排除

[提供常见问题的排除指导]

## 后续发展规划

### 版本规划

[描述版本发展规划]

### 功能扩展

[描述未来可能的功能扩展]

### 性能优化

[描述性能优化的方向]
```

## 设计质量要求

### 设计原则

1. **单一职责**: 每个组件都有明确的单一职责
2. **开闭原则**: 对扩展开放，对修改封闭
3. **依赖倒置**: 依赖抽象而不是具体实现
4. **接口隔离**: 接口应该小而专一
5. **最小惊讶**: API设计应该符合用户预期

### 质量标准

1. **可用性**: 设计的API应该简单易用
2. **可扩展性**: 架构应该支持未来的功能扩展
3. **可维护性**: 代码结构应该清晰易维护
4. **可测试性**: 设计应该便于编写测试
5. **性能**: 设计应该考虑性能要求

### 文档完整性

1. **API文档**: 所有公开接口都有完整文档
2. **使用示例**: 提供丰富的使用示例
3. **架构说明**: 清晰的架构设计说明
4. **实现指导**: 详细的实现指导
5. **测试指导**: 完整的测试策略

## 工作执行步骤

### 步骤 1: 深度需求分析 (更新 todo-list.md)

1. **理解用户需求**:
   - 仔细分析用户的需求描述
   - 识别核心功能和边界
   - 确定使用场景和用户群体

2. **分析现有系统**:
   - 研究AutoCoder现有架构
   - 识别可复用的组件
   - 确定集成点和依赖关系

3. **定义功能范围**:
   - 明确模块的核心功能
   - 确定功能的优先级
   - 识别可选功能和扩展点

**更新要求**: 在 todo-list.md 中记录需求分析结果

### 步骤 2: 架构设计 (更新 todo-list.md)

1. **整体架构设计**:
   - 设计模块的整体架构
   - 确定核心组件和职责
   - 设计组件间的交互方式

2. **数据模型设计**:
   - 设计核心数据结构
   - 定义类型和接口
   - 设计数据流转方式

3. **错误处理设计**:
   - 设计异常层次结构
   - 定义错误处理策略
   - 设计错误恢复机制

**更新要求**: 在 todo-list.md 中记录架构设计决策

### 步骤 3: API设计 (更新 todo-list.md)

1. **接口设计**:
   - 设计公开API接口
   - 定义函数签名和参数
   - 设计返回值和异常

2. **使用示例设计**:
   - 设计基础使用示例
   - 设计高级使用场景
   - 设计集成使用示例

3. **配置设计**:
   - 设计配置选项
   - 定义默认值
   - 设计配置验证

**更新要求**: 在 todo-list.md 中记录API设计细节

### 步骤 4: 实现指导编写 (更新 todo-list.md)

1. **开发计划**:
   - 制定开发阶段规划
   - 定义里程碑和验收标准
   - 识别技术难点和风险

2. **实现指导**:
   - 编写详细的实现步骤
   - 提供技术实现建议
   - 设计测试策略

3. **质量保证**:
   - 定义代码质量标准
   - 设计性能基准
   - 制定安全检查清单

**更新要求**: 在 todo-list.md 中记录实现指导内容

## 质量检查清单

在完成设计文档后，使用以下清单进行最终检查，并在 todo-list.md 中记录检查结果：

### 设计完整性 ✅
- [ ] 功能定位明确，解决的问题清晰
- [ ] 架构设计合理，组件职责明确
- [ ] API设计完整，接口定义清晰
- [ ] 数据模型设计合理，类型定义完整
- [ ] 错误处理策略完善

### 可实现性 ✅
- [ ] 技术方案可行，没有明显技术障碍
- [ ] 依赖关系清晰，外部依赖可获得
- [ ] 实现步骤详细，开发计划合理
- [ ] 测试策略完整，质量保证措施到位
- [ ] 性能和安全考虑充分

### 可用性 ✅
- [ ] API设计简单易用，符合用户习惯
- [ ] 使用示例丰富，覆盖主要场景
- [ ] 配置选项合理，默认值适当
- [ ] 错误信息清晰，便于问题排查
- [ ] 文档完整，便于理解和使用

### 可扩展性 ✅
- [ ] 架构设计支持功能扩展
- [ ] 接口设计考虑向后兼容
- [ ] 插件机制设计合理（如适用）
- [ ] 配置系统支持灵活配置
- [ ] 版本规划考虑未来发展

## 最终交付要求

### 核心交付产物

**1. `.ac.mod.md` 设计文档** (主要交付物)
- **文件名**: 固定为 `.ac.mod.md` 
- **位置**: 模块根目录下
- **内容**: 按照标准结构编写的完整模块设计文档
- **要求**: 必须包含所有必需章节，参考现有示例的组织方式
- **用途**: 作为后续代码实现的完整蓝图和指导文档

**2. `todo-list.md` 文件** (过程记录)
- **内容**: 记录完整设计过程的状态追踪文件
- **要求**: 包含所有设计阶段的进度和决策记录
- **用途**: 展示设计思路和决策过程

**3. 设计总结** (在 todo-list.md 末尾)
- 模块的核心价值和创新点
- 关键设计决策和理由
- 主要技术挑战和解决方案
- 实现建议和注意事项
- 后续优化和扩展方向

### 交付物检查清单

**`.ac.mod.md` 文件必须包含:**
- [ ] 模块名称和功能描述
- [ ] 完整的目录结构规划
- [ ] 详细的API设计和使用示例
- [ ] 清晰的架构设计和组件说明
- [ ] Mermaid依赖关系图
- [ ] 分阶段的实现指导
- [ ] 完整的测试策略
- [ ] 与现有系统的集成方案

**文件质量要求:**
- [ ] 结构清晰，章节完整
- [ ] 内容详实，可直接指导实现
- [ ] 代码示例准确，符合项目规范
- [ ] 设计合理，考虑扩展性和维护性

## 注意事项

1. **始终保持 todo-list.md 更新**: 这是设计过程的重要记录
2. **设计要考虑实现可行性**: 不要设计过于复杂或不可实现的方案
3. **保持与项目风格一致**: 参考现有模块的设计风格和模式
4. **注重用户体验**: 设计应该真正解决用户的问题
5. **考虑未来扩展**: 设计时要为未来的功能扩展留有空间
6. **及时记录设计决策**: 在 todo-list.md 中记录重要的设计决策和理由

## 开始设计

现在请开始为用户需求设计模块，**最终目标是生成完整的 `.ac.mod.md` 文件**：

### 设计流程

1. **创建工作追踪文件**: 首先创建 `todo-list.md` 文件记录设计过程
2. **需求分析和理解**: 深入分析用户需求，明确模块功能和边界
3. **架构设计**: 设计整体架构、组件和数据模型
4. **API设计**: 设计公开接口和使用方式
5. **文件结构规划**: 规划目录结构和文件组织
6. **实现指导编写**: 提供详细的实现步骤和技术指导
7. **质量检查**: 使用检查清单验证设计完整性
8. **生成最终文档**: **创建完整的 `.ac.mod.md` 文件**

### 重要提醒

- **核心目标**: 生成符合标准的 `.ac.mod.md` 设计文档
- **过程记录**: 每完成一个重要设计步骤都要更新 `todo-list.md` 文件
- **质量标准**: 设计文档应该足够详细，让开发者能够直接根据文档进行代码实现
- **参考示例**: 可参考 `src/autocoder/common/v2/agent/.ac.mod.md` 的结构和组织方式

### 最终交付

确保最终生成的 `.ac.mod.md` 文件包含：
- 完整的模块设计说明
- 详细的API接口设计
- 清晰的架构和依赖关系
- 可执行的实现指导
- 完整的使用示例

**开始设计吧！记住，`.ac.mod.md` 文件是你的最终交付产物。**

